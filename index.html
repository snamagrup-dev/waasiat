<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rumah Fiqih Bismi - Advanced Engine</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <style>
        body { background-color: #f8f9fa; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        rect { cursor: pointer; transition: all 0.2s ease-in-out; }
        rect:hover { filter: brightness(1.1); }
        .float {
            position: fixed; width: 70px; height: 70px; bottom: 40px; right: 40px;
            background-color: #0d6efd; color: #FFF; border-radius: 50px;
            text-align: center; box-shadow: 2px 2px 8px #999; z-index: 1000;
            cursor: pointer; transition: all 0.3s;
        }
        .float:hover { background-color: #0b5ed7; transform: scale(1.05); }
        .my-float { margin-top: 15px; font-size: 24px; }
        .legend { display: none; margin-bottom: 80px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .svg-container { overflow-x: auto; overflow-y: hidden; width: 100%; cursor: grab; }
        .svg-container:active { cursor: grabbing; }
        svg { max-width: none; transition: transform 0.3s ease; transform-origin: top left;}
        .card { border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .alert-primary { background-color: #e4ecfb; border-color: #c9dbf7; color: #1a3b70; border-radius: 12px;}
    </style>
</head>
<body>

    <div class="collapse bg-dark" id="navbarHeader">
        <div class="container">
            <div class="row">
                <div class="col-sm-8 col-md-7 py-4">
                    <h4 class="text-white">About Faraidh Engine</h4>
                    <p class="text-muted">Ini adalah simulator Faraidh menggunakan pendekatan Rule-Based System. Algoritma mengevaluasi Mahjub (blocking), Ashabul Furudh, Asabah, mencari KPK (Asal Masalah), dan melakukan Tashih secara dinamis.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="navbar navbar-dark bg-dark shadow-sm">
        <div class="container">
            <a href="/" class="navbar-brand d-flex align-items-center">
                <strong><i class="fa fa-calculator"></i> Rumah Fiqih Bismi</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarHeader">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </div>

    <div class="modal fade" id="mdl_entri_jumlah" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="modal_heir_title">Pilih Ahli Waris</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <label class="form-label text-muted">Berapa jumlah ahli waris ini yang masih hidup?</label>
                    <div class="input-group input-group-lg">
                        <select id="jml_ahli" class="form-select" autofocus>
                            <option value="0" selected>Tidak Ada (0)</option>
                            <option value="1">1 Orang</option>
                            <option value="2">2 Orang</option>
                            <option value="3">3 Orang</option>
                            <option value="4">4 Orang</option>
                            <option value="5">5 Orang</option>
                            <option value="6">6 Orang</option>
                            <option value="7">7 Orang</option>
                            <option value="8">8 Orang</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-primary" id="btn_save_jumlah">Simpan</button>
                </div>
            </div>
        </div>
    </div>

    <main role="main" class="py-4">
        <div class="container">
            <div class="row mb-4 alert alert-primary">
                <div class="col-md-12">
                    <p><b>Petunjuk Penggunaan:</b> Masukkan total harta peninggalan. Klik kotak pada diagram Faraidh untuk menentukan jumlah ahli waris yang hidup.</p>
                    <label class="form-label fw-bold">Total Harta Waris (Rp)</label>
                    <div class="input-group input-group-lg">
                        <span class="input-group-text bg-white border-end-0">Rp. </span>
                        <input type="text" class="form-control fw-bold border-start-0 ps-0" id="harta" inputmode="numeric" value="1.000.000.000">
                    </div>
                    <p id="terbilang" class="py-2 text-success fw-bold fst-italic">Satu Miliar Rupiah</p>
                </div>
            </div>

            <div class="row mb-5">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0 fw-bold"><i class="fa fa-sitemap text-primary"></i> Skema Ahli Waris</h5>
                            <button class="btn btn-outline-secondary btn-sm" id="perbesar">
                                <i class="fa fa-search-plus"></i> <span id="txt_zoom">Zoom Out</span>
                            </button>
                        </div>
                        <div class="card-body p-0">
                            <div class="svg-container bg-light" id="skema">
                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1692px" height="1084px" viewBox="-0.5 -0.5 1692 1084" id="main_svg" style="transform: scale(0.6);">
                                    <g id="svg-target">
                                        <rect x="961" y="58.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#fbcc4f" id="_8_box"></rect>
                                        <text x="1035.17" y="104.67" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Ibunya Ayah</text>
                                        <rect x="982" y="35" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="1035.17" y="58" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">ام اب</text>
                                        <ellipse cx="1035.67" cy="17.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="1036" y="22" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">8</text>
                                        <rect x="971" y="117" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_8_orang" x="981" y="131" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_8_bagian" x="1108" y="134" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_8_jatah" x="1108" y="121" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_8_mahjub" x="1037" y="88" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="160" y="58.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#fbcc4f" id="_21_box"></rect>
                                        <text x="234.16" y="104.67" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Ibunya Ibu</text>
                                        <rect x="181" y="35" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="234.16" y="58" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">ام ام</text>
                                        <ellipse cx="234.66" cy="17.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="235" y="22" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">21</text>
                                        <rect x="170" y="117" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_21_orang" x="180" y="131" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_21_bagian" x="307" y="134" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_21_jatah" x="307" y="121" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_21_mahjub" x="236" y="88" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="160" y="278.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#fbcc4f" id="_6_box"></rect>
                                        <text x="234.16" y="324.67" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Ibu</text>
                                        <rect x="181" y="255" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="234.16" y="278" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">ام</text>
                                        <ellipse cx="234.66" cy="237.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="235" y="242" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">6</text>
                                        <rect x="170" y="337" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_6_orang" x="180" y="351" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_6_bagian" x="306" y="354" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_6_jatah" x="306" y="341" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_6_mahjub" x="235" y="308" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="410" y="758.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#e48bf5" id="_2_box"></rect>
                                        <text x="484.16" y="804.67" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Anak Perempuan</text>
                                        <rect x="431" y="735" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="484.16" y="758" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">بنت</text>
                                        <ellipse cx="484.66" cy="717.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="485" y="722" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">2</text>
                                        <rect x="420" y="817" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_2_orang" x="430" y="831" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_2_bagian" x="554" y="835" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_2_jatah" x="554" y="822" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_2_mahjub" x="483" y="789" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="960" y="278.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#fbcc4f" id="_5_box"></rect>
                                        <text x="1034.17" y="324.67" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Ayah</text>
                                        <rect x="981" y="255" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="1034.17" y="278" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">اب</text>
                                        <ellipse cx="1034.67" cy="237.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="1035" y="242" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">5</text>
                                        <rect x="970" y="337" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_5_orang" x="980" y="351" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_5_bagian" x="1105" y="354" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_5_jatah" x="1105" y="341" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_5_mahjub" x="1034" y="308" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="1370" y="278.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#74b8ff" id="_15_box"></rect>
                                        <text x="1444.17" y="316.17" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Paman</text>
                                        <text x="1444.17" y="333.17" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Seayah-Seibu</text>
                                        <rect x="1391" y="255" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="1444.16" y="278" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">عم شقيق</text>
                                        <ellipse cx="1444.67" cy="237.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="1445" y="242" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">15</text>
                                        <rect x="1380" y="337" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_15_orang" x="1390" y="351" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_15_bagian" x="1511" y="358" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_15_jatah" x="1511" y="345" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_15_mahjub" x="1443" y="303" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="170" y="518.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#ff3f3c" id="_3_box"></rect>
                                        <text x="244.16" y="564.67" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Istri</text>
                                        <rect x="191" y="495" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="244.16" y="518" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">زوجة</text>
                                        <ellipse cx="244.66" cy="477.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="245" y="482" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">3</text>
                                        <rect x="180" y="577" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_3_orang" x="190" y="591" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_3_bagian" x="311" y="594" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_3_jatah" x="311" y="581" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_3_mahjub" x="245" y="548" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="340" y="520" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#ff3f3c" id="_4_box"></rect>
                                        <text x="414.16" y="566.34" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Suami</text>
                                        <rect x="361" y="496.67" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="414.16" y="519.67" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">زوج</text>
                                        <ellipse cx="414.66" cy="479.17" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="415" y="484" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">4</text>
                                        <rect x="350" y="578.67" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_4_orang" x="360" y="593" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_4_bagian" x="486" y="595" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_4_jatah" x="486" y="582" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_4_mahjub" x="415" y="550" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="520" y="520" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#ffffff" stroke="#000000" stroke-width="2"></rect>
                                        <text x="594.16" y="557.34" fill="#000" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="18px">المورّث</text>
                                        <text x="594.16" y="581.34" fill="#000" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="18px">PEWARIS</text>

                                        <rect x="680" y="998.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#e48bf5" id="_19_box"></rect>
                                        <text x="754.16" y="1044.67" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Cucu Laki-laki</text>
                                        <rect x="701" y="975" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="754.16" y="998" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">ابن ابن</text>
                                        <ellipse cx="754.66" cy="957.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="755" y="962" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">19</text>
                                        <rect x="690" y="1057" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_19_orang" x="700" y="1071" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_19_bagian" x="821" y="1074" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_19_jatah" x="821" y="1061" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_19_mahjub" x="750" y="1028" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="0" y="518.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#b5fa4f" id="_22_box"></rect>
                                        <text x="74.16" y="564.67" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Sdr/i Seibu</text>
                                        <rect x="21" y="495" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="74.16" y="518" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">اخ/اخت لام</text>
                                        <ellipse cx="74.67" cy="477.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="75" y="482" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">22</text>
                                        <rect x="10" y="577" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_22_orang" x="20" y="591" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_22_bagian" x="141" y="594" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_22_jatah" x="141" y="581" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_22_mahjub" x="70" y="548" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="1030" y="518.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#b5fa4f" id="_11_box"></rect>
                                        <text x="1104.17" y="564.67" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Saudara Seayah</text>
                                        <rect x="1051" y="495" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="1104.17" y="518" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">اخ لاب</text>
                                        <ellipse cx="1104.67" cy="477.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="1105" y="482" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">11</text>
                                        <rect x="1040" y="577" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_11_orang" x="1050" y="591" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_11_bagian" x="1171" y="594" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_11_jatah" x="1171" y="581" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_11_mahjub" x="1100" y="548" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="590" y="758.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#e48bf5" id="_1_box"></rect>
                                        <text x="664.16" y="804.67" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Anak Laki-laki</text>
                                        <rect x="611" y="735" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="664.16" y="758" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">ابن</text>
                                        <ellipse cx="664.66" cy="717.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="665" y="722" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">1</text>
                                        <rect x="600" y="817" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_1_orang" x="610" y="831" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_1_bagian" x="731" y="834" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_1_jatah" x="731" y="821" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_1_mahjub" x="660" y="788" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="860" y="518.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#b5fa4f" id="_9_box"></rect>
                                        <text x="934.17" y="556.17" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Saudara</text>
                                        <text x="934.17" y="573.17" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Seayah-Seibu</text>
                                        <rect x="881" y="495" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="934.17" y="518" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">اخ شقيق</text>
                                        <ellipse cx="934.66" cy="477.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="935" y="482" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">9</text>
                                        <rect x="870" y="577" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_9_orang" x="880" y="591" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_9_bagian" x="1002" y="598" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_9_jatah" x="1002" y="585" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_9_mahjub" x="936" y="545" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="690" y="518.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#b5fa4f" id="_10_box"></rect>
                                        <text x="764.16" y="556.17" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Saudari</text>
                                        <text x="764.16" y="573.17" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Seayah-Seibu</text>
                                        <rect x="711" y="495" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="764.16" y="518" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">اخت شقيقة</text>
                                        <ellipse cx="764.66" cy="477.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="765" y="482" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">10</text>
                                        <rect x="700" y="577" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_10_orang" x="710" y="591" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_10_bagian" x="832" y="597" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_10_jatah" x="832" y="584" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_10_mahjub" x="763" y="544" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="1200" y="518.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#b5fa4f" id="_12_box"></rect>
                                        <text x="1274.17" y="564.67" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Saudari Seayah</text>
                                        <rect x="1221" y="495" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="1274.16" y="518" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">اخت لاب</text>
                                        <ellipse cx="1274.67" cy="477.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="1275" y="482" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">12</text>
                                        <rect x="1210" y="577" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_12_orang" x="1220" y="591" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_12_bagian" x="1341" y="594" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_12_jatah" x="1341" y="581" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_12_mahjub" x="1270" y="548" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="860" y="758.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#1ab309" id="_13_box"></rect>
                                        <text x="934.17" y="796.17" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Keponakan</text>
                                        <text x="934.17" y="813.17" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Laki-laki</text>
                                        <rect x="881" y="735" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="934.17" y="758" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">ابن اخ شقيق</text>
                                        <ellipse cx="934.66" cy="717.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="935" y="722" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">13</text>
                                        <rect x="870" y="817" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_13_orang" x="880" y="831" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_13_bagian" x="1004" y="837" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_13_jatah" x="1004" y="824" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_13_mahjub" x="933" y="784" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="510" y="998.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#e48bf5" id="_20_box"></rect>
                                        <text x="584.16" y="1044.67" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Cucu Perempuan</text>
                                        <rect x="531" y="975" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="584.16" y="998" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">بنت ابن</text>
                                        <ellipse cx="584.66" cy="957.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="585" y="962" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">20</text>
                                        <rect x="520" y="1057" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_20_orang" x="530" y="1071" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_20_bagian" x="657" y="1074" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_20_jatah" x="657" y="1061" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_20_mahjub" x="586" y="1028" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="1370" y="520" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#74b8ff" id="_17_box"></rect>
                                        <text x="1444.17" y="566.34" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Sepupu Laki</text>
                                        <rect x="1391" y="496.67" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="1444.16" y="519.67" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">ابن عم شقيق</text>
                                        <ellipse cx="1444.67" cy="479.17" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="1445" y="484" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">17</text>
                                        <rect x="1380" y="578.67" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_17_orang" x="1390" y="593" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_17_bagian" x="1511" y="595" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_17_jatah" x="1511" y="582" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_17_mahjub" x="1440" y="550" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="1540" y="518.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#74b8ff" id="_18_box"></rect>
                                        <text x="1614.17" y="564.67" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Sepupu Laki</text>
                                        <rect x="1561" y="495" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="1614.16" y="518" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">ابن عم لاب</text>
                                        <ellipse cx="1614.67" cy="477.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="1615" y="482" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">18</text>
                                        <rect x="1550" y="577" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_18_orang" x="1560" y="591" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_18_bagian" x="1681" y="594" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_18_jatah" x="1681" y="581" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_18_mahjub" x="1610" y="548" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="1540" y="278.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#74b8ff" id="_16_box"></rect>
                                        <text x="1614.17" y="324.67" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Paman Seayah</text>
                                        <rect x="1561" y="255" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="1614.16" y="278" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">عم لاب</text>
                                        <ellipse cx="1614.67" cy="237.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="1615" y="242" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">16</text>
                                        <rect x="1550" y="337" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_16_orang" x="1560" y="351" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_16_bagian" x="1687" y="354" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_16_jatah" x="1687" y="341" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_16_mahjub" x="1616" y="308" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="1200" y="58.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#fbcc4f" id="_7_box"></rect>
                                        <text x="1274.17" y="104.67" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Ayahnya Ayah</text>
                                        <rect x="1221" y="35" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="1274.16" y="58" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">اب اب</text>
                                        <ellipse cx="1274.67" cy="17.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="1275" y="22" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">7</text>
                                        <rect x="1210" y="117" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_7_orang" x="1220" y="131" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_7_bagian" x="1341" y="134" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_7_jatah" x="1341" y="121" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_7_mahjub" x="1270" y="88" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <rect x="1030" y="758.33" width="149.33" height="81.67" rx="12.25" ry="12.25" fill="#1ab309" id="_14_box"></rect>
                                        <text x="1104.17" y="796.17" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Keponakan</text>
                                        <text x="1104.17" y="813.17" fill="#0" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">Laki-laki</text>
                                        <rect x="1051" y="735" width="107.33" height="35" rx="5.25" ry="5.25" fill="#000000"></rect>
                                        <text x="1104.17" y="758" fill="#FFFFFF" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px">ابن اخ لاب</text>
                                        <ellipse cx="1104.67" cy="717.5" rx="17.5" ry="17.5" fill="#000000"></ellipse>
                                        <text x="1105" y="722" fill="#FFFFFF" font-family="Helvetica" font-size="14px" text-anchor="middle">14</text>
                                        <rect x="1040" y="817" width="20" height="20" rx="3" ry="3" fill="#FFFFFF" stroke="#000"></rect>
                                        <text id="_14_orang" x="1050" y="831" fill="#000" font-family="Helvetica" font-size="13px" font-weight="bold" text-anchor="middle">0</text>
                                        <text id="_14_bagian" x="1174" y="837" fill="#666" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_14_jatah" x="1174" y="824" fill="#000" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="end"></text>
                                        <text id="_14_mahjub" x="1100" y="784" fill="#d9534f" font-weight="bold" font-family="Helvetica" font-size="12px" text-anchor="middle" style="display:none;">Mahjub</text>

                                        <path d="M 310 320 L 960 319.53" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 235 140 L 235 180 Q 235 190 234.89 200 L 234.66 220" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 160 319.17 L 84.66 319.9 Q 74.67 320 74.67 330 L 74.67 460" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 319.33 559.17 L 330 559.35 Q 340 559.53 340 560.18 L 340 560.84" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 490 560 L 520 560.58" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 590 520 L 590 430 Q 590 420 600 420 L 924.66 420 Q 934.66 420 934.66 430 L 934.66 460" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 760 460 L 760 390.05 L 760 320" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 1104.67 460 L 1104.67 430 Q 1104.67 420 1114.67 420 L 1264.67 420 Q 1274.67 420 1274.67 430 L 1274.67 460" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 1109.33 319.17 L 1190 319.02 Q 1200 319 1200 329 L 1200 420" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 480.01 700 L 480.01 680 Q 480.01 670 490.01 670 L 654.66 670 Q 664.66 670 664.66 680 L 664.66 700" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 584.66 940 L 584.66 920 Q 584.66 910 594.66 910 L 750 910 Q 760 910 760 920 L 760 940" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 1034.67 220 L 1034.67 210 Q 1034.67 200 1044.67 200 L 1434.67 200 Q 1444.67 200 1444.67 210 L 1444.67 220" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 595 670 L 595 635.32 L 594.66 601.67" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 664 910 L 664 875.32 L 663.95 840" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 934.66 700 L 934.66 650.05 L 934.67 600" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 1105 700 L 1105 650.05 L 1104.67 600" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 1444.67 461.67 L 1444.67 411.11 L 1445 360" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 1614.67 460 L 1614.67 410.05 L 1613.95 360" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 1110.33 99.17 L 1201 99.53" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 1349.33 99.17 L 1604.67 99.97 Q 1614.67 100 1614.67 110 L 1614.67 220" fill="none" stroke="#23445d" stroke-width="4"></path>
                                        <path d="M 1160 200 L 1160 150.05 L 1160 100" fill="none" stroke="#23445d" stroke-width="4"></path>
                                    </g>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="table-responsive-sm legend">
                        <table style="background: #E4ECFB;" class="table table-bordered table-hover mb-0" id="tbl-container">
                            <thead class="table-primary">
                                <tr>
                                    <th>Ahli Waris</th>
                                    <th class="text-center">Bagian</th>
                                    <th class="text-center">Jumlah</th>
                                    <th class="text-end">Harta Total</th>
                                    <th class="text-end">Harta Per Orang</th>
                                </tr>
                            </thead>
                            <tbody id="hasil">
                                <tr><td colspan="5" class="text-center text-muted">Belum ada ahli waris yang dipilih</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <span class="float shadow-lg d-flex flex-column align-items-center justify-content-center" data-bs-toggle="tooltip" data-bs-placement="top" title="Lihat Hasil">
                        <i class="fa fa-folder my-float mt-1"></i>
                        <small style="font-size: 11px; font-weight:bold; margin-top:-5px">Hasil</small>
                    </span>
                </div>
            </div>
        </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        /* Utils */
        function terbilang(angka) {
            var bilangan = ["", "Satu", "Dua", "Tiga", "Empat", "Lima", "Enam", "Tujuh", "Delapan", "Sembilan", "Sepuluh", "Sebelas"];
            var temp = "";
            angka = parseFloat(angka);
            if (angka < 12) temp = " " + bilangan[angka];
            else if (angka < 20) temp = terbilang(angka - 10) + " Belas";
            else if (angka < 100) temp = terbilang(Math.floor(angka / 10)) + " Puluh" + terbilang(angka % 10);
            else if (angka < 200) temp = " Seratus" + terbilang(angka - 100);
            else if (angka < 1000) temp = terbilang(Math.floor(angka / 100)) + " Ratus" + terbilang(angka % 100);
            else if (angka < 2000) temp = " Seribu" + terbilang(angka - 1000);
            else if (angka < 1000000) temp = terbilang(Math.floor(angka / 1000)) + " Ribu" + terbilang(angka % 1000);
            else if (angka < 1000000000) temp = terbilang(Math.floor(angka / 1000000)) + " Juta" + terbilang(angka % 1000000);
            else if (angka < 1000000000000) temp = terbilang(Math.floor(angka / 1000000000)) + " Miliar" + terbilang(angka % 1000000000);
            else if (angka < 1000000000000000) temp = terbilang(Math.floor(angka / 1000000000000)) + " Triliun" + terbilang(angka % 1000000000000);
            else if (angka < 1000000000000000000) temp = terbilang(Math.floor(angka / 1000000000000000)) + " Kuadriliun" + terbilang(angka % 1000000000000000);
            return temp;
        }

        function formatRupiah(angka) {
            var number_string = angka.replace(/[^,\d]/g, '').toString(), split = number_string.split(','),
                sisa = split[0].length % 3, rupiah = split[0].substr(0, sisa), ribuan = split[0].substr(sisa).match(/\d{3}/gi);
            if (ribuan) { let separator = sisa ? '.' : ''; rupiah += separator + ribuan.join('.'); }
            return split[1] != undefined ? rupiah + ',' + split[1] : rupiah;
        }

        function lcm(arr) {
            const gcd = (a, b) => a ? gcd(b % a, a) : b;
            const lcm = (a, b) => a * b / gcd(a, b);
            return arr.reduce(lcm, 1);
        }

        $(document).ready(function() {
            $('#harta').on('keyup', function() {
                this.value = formatRupiah(this.value);
                let num = this.value.replace(/\./g, '');
                $('#terbilang').text(num ? terbilang(num) + ' Rupiah' : '');
                Engine.run();
            });

            const HEIRS = {
                1: {name: "Anak Lk", gender: "M"}, 2: {name: "Anak Pr", gender: "F"}, 
                3: {name: "Istri", gender: "F"}, 4: {name: "Suami", gender: "M"},
                5: {name: "Ayah", gender: "M"}, 6: {name: "Ibu", gender: "F"}, 
                7: {name: "Kakek", gender: "M"}, 8: {name: "Nenek (Ayah)", gender: "F"},
                9: {name: "Sdr K", gender: "M"}, 10: {name: "Sdri K", gender: "F"}, 
                11: {name: "Sdr Seayah", gender: "M"}, 12: {name: "Sdri Seayah", gender: "F"}, 
                13: {name: "Keponakan K", gender: "M"}, 14: {name: "Keponakan Seayah", gender: "M"},
                15: {name: "Paman K", gender: "M"}, 16: {name: "Paman Seayah", gender: "M"}, 
                17: {name: "Sepupu K", gender: "M"}, 18: {name: "Sepupu Seayah", gender: "M"},
                19: {name: "Cucu Lk", gender: "M"}, 20: {name: "Cucu Pr", gender: "F"}, 
                21: {name: "Nenek (Ibu)", gender: "F"}, 22: {name: "Sdr/i Seibu", gender: "X"}
            };

            let state = {};
            for(let i=1; i<=22; i++) state[i] = 0;
            let currentId = null;
            let modal = new bootstrap.Modal(document.getElementById('mdl_entri_jumlah'));

            $('rect[id$="_box"]').on('click', function() {
                currentId = parseInt($(this).attr('id').split('_')[1]);
                $('#modal_heir_title').text(HEIRS[currentId].name);
                $('#jml_ahli').val(state[currentId]);
                modal.show();
            });

            $('#btn_save_jumlah').on('click', function() {
                let val = parseInt($('#jml_ahli').val());
                if (currentId) {
                    state[currentId] = val;
                    $('#_' + currentId + '_orang').text(val);
                    $('#_' + currentId + '_box').attr('stroke', val > 0 ? '#ff0000' : 'none').attr('stroke-width', val > 0 ? '4' : '0');
                    Engine.run();
                }
                modal.hide();
                $('.legend').slideDown();
            });

            $('.float').click(function() {
                $('.legend').slideToggle();
                $(this).find('i').toggleClass('fa-folder fa-folder-open');
                $('html, body').animate({ scrollTop: $(document).height() }, 500);
            });

            let zoom = 0.6;
            $('#perbesar').click(function() {
                zoom = zoom === 1 ? 0.6 : 1;
                $('#txt_zoom').text(zoom === 1 ? 'Zoom Out' : 'Zoom In');
                $('#main_svg').css('transform', `scale(${zoom})`);
            });

            // ==========================================
            // CORE FARAIDH ALGORITHM ENGINE
            // ==========================================
            const Engine = {
                run: function() {
                    let totalHarta = parseFloat($('#harta').val().replace(/\./g, '')) || 0;
                    
                    // Reset UI
                    for(let i=1; i<=22; i++) {
                        $(`#_${i}_bagian`).text(''); $(`#_${i}_jatah`).text(''); $(`#_${i}_mahjub`).hide();
                    }

                    let h = state; // alias for counts
                    let m = {}; // mahjub flags
                    for(let i=1; i<=22; i++) m[i] = false;

                    let furudh = {}; // format: {id: {num: 1, den: 2, label: "1/2"}}
                    let asobah = {}; // format: {id: ratio} (2 for M, 1 for F)

                    let activeCount = Object.values(h).reduce((a,b)=>a+b, 0);
                    if(activeCount === 0) {
                        $('#hasil').html('<tr><td colspan="5" class="text-center text-muted">Pilih minimal 1 ahli waris.</td></tr>');
                        return;
                    }

                    // 1. MAHJUBS (Exclusion Rules)
                    let block = (by, list) => { if(h[by]>0) list.forEach(x => m[x] = true); };
                    
                    block(1, [7,8,9,10,11,12,13,14,15,16,17,18,19,20,22]); // Anak Lk
                    block(5, [7,8,9,10,11,12,13,14,15,16,17,18,22]); // Ayah
                    block(19, [7,8,9,10,11,12,13,14,15,16,17,18,22]); // Cucu Lk
                    block(6, [8,21]); // Ibu
                    block(9, [11,12,13,14,15,16,17,18]); // Sdr Lk Sekandung
                    block(11, [13,14,15,16,17,18]); // Sdr Lk Seayah
                    block(13, [14,15,16,17,18]); // Keponakan K
                    block(14, [15,16,17,18]); // Keponakan A
                    block(15, [16,17,18]); // Paman K
                    block(16, [17,18]); // Paman A
                    block(17, [18]); // Sepupu K

                    // Custom partial blocks
                    if (h[2] >= 2 && h[19] == 0) m[20] = true; // 2+ Daughters block Cucu Pr
                    if (h[10] >= 2 && h[11] == 0) m[12] = true; // 2+ Sdr Pr K blocks Sdr Pr A

                    // 2. ASSIGN FURUDH (Fixed Shares)
                    let hasChild = h[1] || h[2] || (!m[19] && h[19]) || (!m[20] && h[20]);
                    let hasMaleChild = h[1] || (!m[19] && h[19]);
                    let sibCount = (h[9]+h[10]+h[11]+h[12]+h[22]);

                    // Suami
                    if(h[4] && !m[4]) furudh[4] = hasChild ? {num: 1, den: 4, label: "1/4"} : {num: 1, den: 2, label: "1/2"};
                    // Istri
                    if(h[3] && !m[3]) furudh[3] = hasChild ? {num: 1, den: 8, label: "1/8"} : {num: 1, den: 4, label: "1/4"};
                    // Ibu
                    if(h[6] && !m[6]) furudh[6] = (hasChild || sibCount >= 2) ? {num: 1, den: 6, label: "1/6"} : {num: 1, den: 3, label: "1/3"};
                    // Ayah
                    if(h[5] && !m[5]) {
                        if(hasMaleChild) furudh[5] = {num: 1, den: 6, label: "1/6"};
                        else if(hasChild) { furudh[5] = {num: 1, den: 6, label: "1/6"}; asobah[5] = 1; }
                        else asobah[5] = 1; // Pure asobah
                    }
                    // Nenek
                    if(h[21] && !m[21]) furudh[21] = {num: 1, den: 6, label: "1/6"};
                    if(h[8] && !m[8]) furudh[8] = {num: 1, den: 6, label: "1/6"};
                    
                    // Sdr Seibu
                    if(h[22] && !m[22]) furudh[22] = h[22] > 1 ? {num: 1, den: 3, label: "1/3"} : {num: 1, den: 6, label: "1/6"};

                    // 3. ASOBAH & DESCENDANT/SIBLING SHARING
                    // Anak
                    if(h[1] && !m[1]) {
                        asobah[1] = 2; // Male 2 parts
                        if(h[2]) { asobah[2] = 1; m[2] = false; } // Female 1 part
                    } else if(h[2] && !m[2]) {
                        furudh[2] = h[2] > 1 ? {num: 2, den: 3, label: "2/3"} : {num: 1, den: 2, label: "1/2"};
                    }
                    
                    // Cucu
                    if(!m[19] && h[19]) {
                        asobah[19] = 2;
                        if(h[20]) { asobah[20] = 1; m[20] = false; }
                    } else if(h[20] && !m[20]) {
                        if(h[2] == 1) furudh[20] = {num: 1, den: 6, label: "1/6"};
                        else furudh[20] = h[20] > 1 ? {num: 2, den: 3, label: "2/3"} : {num: 1, den: 2, label: "1/2"};
                    }

                    // Sdr Kandung
                    if(!m[9] && h[9]) {
                        asobah[9] = 2;
                        if(h[10]) { asobah[10] = 1; m[10] = false; }
                    } else if(h[10] && !m[10]) {
                        furudh[10] = h[10] > 1 ? {num: 2, den: 3, label: "2/3"} : {num: 1, den: 2, label: "1/2"};
                    }

                    // Sdr Seayah
                    if(!m[11] && h[11]) {
                        asobah[11] = 2;
                        if(h[12]) { asobah[12] = 1; m[12] = false; }
                    } else if(h[12] && !m[12]) {
                        if(h[10] == 1) furudh[12] = {num: 1, den: 6, label: "1/6"};
                        else furudh[12] = h[12] > 1 ? {num: 2, den: 3, label: "2/3"} : {num: 1, den: 2, label: "1/2"};
                    }

                    // Male strict Asobah
                    let maleAsobah = [7, 13, 14, 15, 16, 17, 18];
                    for(let id of maleAsobah) {
                        if(h[id] && !m[id]) asobah[id] = 1;
                    }

                    // Restrict Asobah to highest priority only
                    if(Object.keys(asobah).length > 0) {
                        const priority = [
                            [1,2], [19,20], [5], [7], [9,10], [11,12], [13], [14], [15], [16], [17], [18]
                        ];
                        let found = false;
                        for(let group of priority) {
                            let inGroup = group.some(id => asobah[id] !== undefined);
                            if(inGroup && !found) found = true; // Keep this group
                            else if (found) group.forEach(id => { delete asobah[id]; }); // Delete lower tiers
                        }
                    }

                    // 4. MATH (KPK, Siham, Aul)
                    let denominators = Object.values(furudh).map(f => f.den);
                    let kpk = denominators.length > 0 ? Math.max(1, lcm(denominators)) : 1;
                    
                    let sihamSum = 0;
                    let siham = {};

                    // Assign Furudh Siham
                    for(let id in furudh) {
                        siham[id] = (kpk / furudh[id].den) * furudh[id].num;
                        sihamSum += siham[id];
                    }

                    let sisa = kpk - sihamSum;

                    // AUL Condition
                    if (sihamSum > kpk) {
                        kpk = sihamSum; // Increase base
                        sisa = 0; // No asobah left
                    } 
                    // RAD Condition (Simplified Rad to all proportionally)
                    else if (sihamSum < kpk && Object.keys(asobah).length === 0) {
                        kpk = sihamSum; // Reduce base (Proportional Rad)
                        sisa = 0;
                    }

                    // 5. TASHIH (Distribute Asobah & Fix Base for integer division)
                    let asobahPoints = 0;
                    for(let id in asobah) {
                        if (sisa > 0) asobahPoints += (asobah[id] * h[id]); // ratio * count
                        else {
                            // Mahjub bil Nuqshan (Blocked by exhausted shares)
                            m[id] = true;
                            delete asobah[id];
                        }
                    }

                    let multiplyBase = 1;
                    if (sisa > 0 && asobahPoints > 0) {
                        // Check if sisa is perfectly divisible by asobahPoints
                        if (sisa % asobahPoints !== 0) {
                            multiplyBase = asobahPoints;
                            kpk *= multiplyBase;
                            sisa *= multiplyBase;
                            for(let id in siham) siham[id] *= multiplyBase;
                        }
                    }

                    // Assign Asobah Siham
                    for(let id in asobah) {
                        siham[id] = (siham[id] || 0) + (sisa / asobahPoints) * (asobah[id] * h[id]);
                        furudh[id] = furudh[id] || {label: "Asabah"};
                        if (furudh[id].num) furudh[id].label += " + Asabah";
                    }

                    // Fix individual count fraction (Tashih for Furudh groups)
                    for(let id in siham) {
                        if(siham[id] % h[id] !== 0) {
                            let t = h[id];
                            kpk *= t;
                            for(let k in siham) siham[k] *= t;
                        }
                    }

                    // 6. RENDER RESULTS
                    let tableHtml = '';
                    let anyResult = false;
                    for(let i=1; i<=22; i++) {
                        if(h[i] > 0) {
                            if(m[i] && !siham[i]) {
                                // Mahjub display
                                $(`#_${i}_mahjub`).show().text("Mahjub").attr('fill', '#d9534f');
                            } else if (siham[i] > 0) {
                                anyResult = true;
                                let fraction = siham[i] / kpk;
                                let jatahGrup = totalHarta * fraction;
                                let jatahPerOrang = jatahGrup / h[i];
                                let labelText = furudh[i].label;

                                tableHtml += `
                                    <tr>
                                        <td>${HEIRS[i].name}</td>
                                        <td class="text-center">${labelText} &rarr; ${siham[i]}/${kpk}</td>
                                        <td class="text-center">${h[i]}</td>
                                        <td class="text-end fw-bold">Rp ${formatRupiah(jatahGrup.toFixed(0))}</td>
                                        <td class="text-end text-success fw-bold">Rp ${formatRupiah(jatahPerOrang.toFixed(0))}</td>
                                    </tr>
                                `;

                                $(`#_${i}_bagian`).text('@' + formatRupiah(jatahPerOrang.toFixed(0)));
                                $(`#_${i}_jatah`).text(formatRupiah(jatahGrup.toFixed(0)));
                                $(`#_${i}_mahjub`).show().text(labelText).attr('fill', '#000');
                            }
                        }
                    }

                    if(!anyResult) tableHtml = '<tr><td colspan="5" class="text-center text-muted">Harta tidak dapat dibagikan (semua Mahjub / tidak valid).</td></tr>';
                    $('#hasil').html(tableHtml);
                }
            };
        });
    </script>
</body>
</html>



